import{r as m,o as d,c as u,w as S,v as O,a as n,b as A,t as T,p as F,d as M,u as G,e as J,f as D,g as K,n as $,F as W,h as R,i as q}from"./index-DkPr4FNd.js";import{_ as P,u as p,a as _,t as k,T as Z}from"./toast-CfX0GIoQ.js";const Q="/vite-todolist/assets/8911ab6dcbda98df56e26aa23c6643ac-CwWZoW3o.png";async function v(a,h,r,o=null){try{let s={method:h,headers:{"Content-Type":"application/json",Authorization:`${r}`},cache:"no-cache"};o&&(s.body=JSON.stringify(o));const c=await fetch(a,s);if(!c.ok){let f=await c.json();throw console.log("錯誤資訊",f),new Error(f.message)}return await c.json()}catch(s){throw s}}async function X(a,h,r,o=null){try{let s={method:h,headers:{"Content-Type":"application/json",Authorization:`${r}`},cache:"no-cache"};o&&(s.body=JSON.stringify(o));const c=await fetch(a,s);if(!c.ok){let f=await c.json();throw console.log("登出錯誤資訊",f),new Error(f.message)}return await c.json()}catch(s){throw s}}const x=a=>(F("data-v-481f0ae4"),a=a(),M(),a),Y={key:0,class:"edit-box"},tt=x(()=>n("span",{class:"material-icons-outlined"},"add",-1)),et=[tt],st={key:0,class:"is-nocheck"},ot={key:1,class:"is-check"},nt=x(()=>n("span",{class:"material-icons-outlined"},"drive_file_rename_outline",-1)),at=[nt],it=x(()=>n("span",{class:"material-icons-outlined"}," edit_off ",-1)),lt=[it],ct=x(()=>n("span",{class:"material-icons-outlined delete-icon"},"clear",-1)),rt=[ct],dt={__name:"listItem",props:{sendData:{type:Object,default:()=>({})}},emits:{changeComplete:a=>{if(typeof a=="object")return!0},deleteItem:a=>{if(typeof a=="object")return!0},editItem:a=>{if(typeof a=="object")return!0},editOffItem:a=>{if(typeof a=="object")return!0},editHandle:(a,h)=>{if(typeof a=="object"&&typeof h=="string")return!0}},setup(a,{emit:h}){const r=m(""),o=a;r.value=o.sendData.content;const s=h;function c(){s("changeComplete",o.sendData)}function f(){s("deleteItem",o.sendData)}function i(){s("editItem",o.sendData)}function y(){s("editOffItem",o.sendData)}function b(){s("editHandle",o.sendData,r.value)}return(E,g)=>(d(),u("li",null,[o.sendData.edit?(d(),u("div",Y,[S(n("input",{class:"edit-input",type:"text","onUpdate:modelValue":g[0]||(g[0]=I=>r.value=I),onKeyup:A(b,["enter"])},null,544),[[O,r.value]]),n("button",{class:"edit-addbtn",onClick:b},et)])):(d(),u("div",{key:1,onClick:c},[o.sendData.status?(d(),u("div",ot)):(d(),u("div",st)),n("p",null,T(o.sendData.content),1)])),o.sendData.edit?(d(),u("button",{key:3,class:"edit-off-link",onClick:y},lt)):(d(),u("button",{key:2,class:"edit-link",onClick:i},at)),n("button",{class:"delete-link",onClick:f},rt)]))}},ut=P(dt,[["__scopeId","data-v-481f0ae4"]]),C=a=>(F("data-v-9f6a47be"),a=a(),M(),a),ft={class:"home-container"},ht={class:"d-none d-sm-block ms-auto me-3 fw-bold"},pt={class:"input-box"},vt=C(()=>n("span",{class:"material-icons-outlined"},"add",-1)),_t=[vt],mt={key:0},yt=C(()=>n("h3",{class:"text-center"},"目前尚無代辦事項",-1)),kt=C(()=>n("img",{class:"img-nolist",src:Q},null,-1)),bt=[yt,kt],gt={key:1,class:"list-box"},wt={class:"filter-btnbox"},xt={class:"todo-list"},Ct={class:"d-flex align-items-baseline px-3"},It=C(()=>n("button",{class:"ms-auto border-0 bg-white"},"清除已完成項目",-1)),Dt={__name:"home",setup(a){const h=G(),r=m(""),o=document.cookie.replace(/(?:(?:^|.*;\s*)TokenCode\s*\=\s*([^;]*).*$)|^.*$/,"$1"),s=m([]),c=m("all"),f=m(""),i=m(!0);J(async()=>{if(i){p("資料讀取中");try{const e=await v("https://todolist-api.hexschool.io/todos/","GET",o);i.value=!1,p("讀取成功"),e.data.forEach(t=>{t.edit=!1,s.value.push(t)})}catch(e){_(e)}finally{i.value=!0}}});const y=e=>{c.value=e},b=D(()=>{if(c.value==="all")return s.value;if(c.value==="pending")return s.value.filter(e=>{if(!e.status)return e});if(c.value==="finish")return s.value.filter(e=>{if(e.status)return e})}),E=D(()=>s.value.filter(t=>{if(!t.status)return t}).length),g=D(()=>s.value.length===0);async function I(){try{const e=await v("https://todolist-api.hexschool.io/users/checkout","GET",o);e.status&&(f.value=e.nickname)}catch{}}I();async function w(){if(i)try{const e=await v("https://todolist-api.hexschool.io/todos/","GET",o);i.value=!1,s.value=[],e.data.forEach(t=>{t.edit=!1,s.value.push(t)})}catch{}finally{i.value=!0}}async function j(){const e={content:r.value};if(i)try{k("新增中");const t=await v("https://todolist-api.hexschool.io/todos/","POST",o,e);i.value=!1,t.status&&(p("新增成功"),w(),r.value="")}catch(t){_(t)}finally{i.value=!0}}async function B(e){if(i)try{k("修改中");const t=e.id;i.value=!1,(await v(`https://todolist-api.hexschool.io/todos/${t}/toggle`,"PATCH",o)).status&&(p("修改完成"),w())}catch(t){_(t)}finally{i.value=!0}}async function L(e){if(i)try{const t=e.id;i.value=!1,k("刪除中"),(await v(`https://todolist-api.hexschool.io/todos/${t}`,"DELETE",o)).status&&(p("刪除完成"),w())}catch(t){_(t)}finally{i.value=!0}}async function N(e,t){if(i)try{const l=e.id,z={content:t};i.value=!1,k("修改中"),(await v(`https://todolist-api.hexschool.io/todos/${l}`,"PUT",o,z)).status&&(p("內容修改完成"),w())}catch(l){_(l)}finally{i.value=!0}}async function H(){if(i)try{k("登出中"),i.value=!1,(await X("https://todolist-api.hexschool.io/users/sign_out","POST",o)).status&&(document.cookie=`TokenCode=${o}; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`,p("登出成功"),h.push("/"))}catch(e){_(e)}finally{i.value=!0}}function U(e){const t=s.value.findIndex(l=>l.id===e.id);s.value.forEach(l=>l.edit=!1),s.value[t].edit=!s.value[t].edit}function V(e){const t=s.value.findIndex(l=>l.id===e.id);s.value[t].edit=!1}return(e,t)=>(d(),u("div",ft,[n("header",null,[K(Z),n("p",ht,T(f.value)+" 的代辦",1),n("a",{class:"login-out",onClick:H},"登出")]),n("div",pt,[S(n("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=l=>r.value=l),onKeyup:A(j,["enter"])},null,544),[[O,r.value]]),n("button",{class:"addinput",onClick:j},_t)]),g.value?(d(),u("div",mt,bt)):(d(),u("div",gt,[n("div",wt,[n("button",{class:$([{buttonActive:c.value==="all"}]),onClick:t[1]||(t[1]=l=>y("all"))},"全部",2),n("button",{class:$([{buttonActive:c.value==="pending"}]),onClick:t[2]||(t[2]=l=>y("pending"))},"待完成",2),n("button",{class:$([{buttonActive:c.value==="finish"}]),onClick:t[3]||(t[3]=l=>y("finish"))},"已完成",2)]),n("ul",xt,[(d(!0),u(W,null,R(b.value,l=>(d(),q(ut,{key:l.id,sendData:l,onChangeComplete:B,onDeleteItem:L,onEditItem:U,onEditOffItem:V,onEditHandle:N},null,8,["sendData"]))),128))]),n("div",Ct,[n("p",null,T(E.value)+"個待完成項目",1),It])]))]))}},jt=P(Dt,[["__scopeId","data-v-9f6a47be"]]);export{jt as default};
