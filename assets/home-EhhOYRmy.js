import{r as _,o as u,c as f,w as A,v as M,a,b as F,t as j,p as P,d as B,u as Z,e as Q,f as X,g as T,h as Y,i as h,n as E,F as tt,j as et,k as st}from"./index-Cv-0C1nB.js";import{_ as H,r as ot,t as k,u as g,a as b,T as nt}from"./toast-BCnJC-rN.js";const at="/vite-todolist/assets/8911ab6dcbda98df56e26aa23c6643ac-CwWZoW3o.png";async function v(n,d,r,o=null){try{let s={method:d,headers:{"Content-Type":"application/json",Authorization:`${r}`},cache:"no-cache"};o&&(s.body=JSON.stringify(o));const c=await fetch(n,s);if(!c.ok){let p=await c.json();throw new Error(p.message)}return await c.json()}catch(s){throw s}}async function it(n,d,r,o=null){try{let s={method:d,headers:{"Content-Type":"application/json",Authorization:`${r}`},cache:"no-cache"};o&&(s.body=JSON.stringify(o));const c=await fetch(n,s);if(!c.ok){let p=await c.json();throw new Error(p.message)}return await c.json()}catch(s){throw s}}const x=n=>(P("data-v-fedbf1c7"),n=n(),B(),n),lt={key:0,class:"edit-box"},ct=x(()=>a("span",{class:"material-icons-outlined"},"add",-1)),rt=[ct],dt={key:0,class:"is-nocheck"},ut={key:1,class:"is-check"},ft=x(()=>a("span",{class:"material-icons-outlined"},"drive_file_rename_outline",-1)),pt=[ft],ht=x(()=>a("span",{class:"material-icons-outlined"}," edit_off ",-1)),vt=[ht],_t=x(()=>a("span",{class:"material-icons-outlined delete-icon"},"clear",-1)),mt=[_t],yt={__name:"listItem",props:{sendData:{type:Object,default:()=>({})}},emits:{changeComplete:n=>{if(typeof n=="object")return!0},deleteItem:n=>{if(typeof n=="object")return!0},editItem:n=>{if(typeof n=="object")return!0},editOffItem:n=>{if(typeof n=="object")return!0},editHandle:(n,d)=>{if(typeof n=="object"&&typeof d=="string")return!0}},setup(n,{emit:d}){const r=_(""),o=n;r.value=o.sendData.content;const s=d;function c(){s("changeComplete",o.sendData)}function p(){s("deleteItem",o.sendData)}function l(){s("editItem",o.sendData)}function m(){s("editOffItem",o.sendData)}function w(){s("editHandle",o.sendData,r.value)}return(O,C)=>(u(),f("li",null,[o.sendData.edit?(u(),f("div",lt,[A(a("input",{class:"edit-input",type:"text","onUpdate:modelValue":C[0]||(C[0]=$=>r.value=$),onKeyup:F(w,["enter"])},null,544),[[M,r.value]]),a("button",{class:"edit-addbtn",onClick:w},rt)])):(u(),f("div",{key:1,onClick:c},[o.sendData.status?(u(),f("div",ut)):(u(),f("div",dt)),a("p",null,j(o.sendData.content),1)])),o.sendData.edit?(u(),f("button",{key:3,class:"edit-off-link",onClick:m},vt)):(u(),f("button",{key:2,class:"edit-link",onClick:l},pt)),a("button",{class:"delete-link",onClick:p},mt)]))}},kt=H(yt,[["__scopeId","data-v-fedbf1c7"]]);function I(n,d){let r=0;return function(){let o=Date.now();o-r>d&&(n.apply(null,arguments),r=o)}}const S=n=>(P("data-v-a2500cfa"),n=n(),B(),n),gt={class:"home-container"},bt={class:"d-none d-sm-block ms-auto me-3 fw-bold"},wt={class:"input-box"},Ct=S(()=>a("span",{class:"material-icons-outlined"},"add",-1)),Dt=[Ct],It={key:0},xt=S(()=>a("h3",{class:"text-center"},"目前尚無代辦事項",-1)),$t=S(()=>a("img",{class:"img-nolist",src:at},null,-1)),Tt=[xt,$t],Et={key:1,class:"list-box"},jt={class:"filter-btnbox"},St={class:"todo-list"},Ot={class:"d-flex align-items-baseline px-3"},At={__name:"home",setup(n){const d=Z(),r=_(""),o=document.cookie.replace(/(?:(?:^|.*;\s*)TokenCode\s*\=\s*([^;]*).*$)|^.*$/,"$1"),s=_([]),c=_("all"),p=_(""),l=_(!0);Q(async()=>{await N()}),X(async()=>{ot(),await y()});const m=e=>{c.value=e},w=T(()=>{if(c.value==="all")return s.value;if(c.value==="pending")return s.value.filter(e=>{if(!e.status)return e});if(c.value==="finish")return s.value.filter(e=>{if(e.status)return e})}),O=T(()=>s.value.filter(t=>{if(!t.status)return t}).length),C=T(()=>s.value.length===0);function $(e){const t=s.value.findIndex(i=>i.id===e.id);s.value.forEach(i=>i.edit=!1),s.value[t].edit=!s.value[t].edit}function L(e){const t=s.value.findIndex(i=>i.id===e.id);s.value[t].edit=!1}async function N(){try{const e=await v("https://todolist-api.hexschool.io/users/checkout","GET",o);e.status&&(p.value=e.nickname)}catch{d.push("/")}}async function y(){if(l)try{const e=await v("https://todolist-api.hexschool.io/todos/","GET",o);l.value=!1,s.value=[],e.data.forEach(t=>{t.edit=!1,s.value.push(t)})}catch{}finally{l.value=!0}}async function U(){const e={content:r.value};if(l)try{k("新增中");const t=await v("https://todolist-api.hexschool.io/todos/","POST",o,e);l.value=!1,t.status&&(g("新增成功"),y(),r.value="")}catch(t){b(t)}finally{l.value=!0}}async function V(e){if(l)try{k("修改中");const t=e.id;l.value=!1,(await v(`https://todolist-api.hexschool.io/todos/${t}/toggle`,"PATCH",o)).status&&(g("修改完成"),y())}catch(t){b(t)}finally{l.value=!0}}async function z(e){if(l)try{const t=e.id;l.value=!1,k("刪除中"),(await v(`https://todolist-api.hexschool.io/todos/${t}`,"DELETE",o)).status&&(g("刪除完成"),y())}catch(t){b(t)}finally{l.value=!0}}async function J(e,t){if(l)try{const i=e.id,q={content:t};l.value=!1,k("修改中"),(await v(`https://todolist-api.hexschool.io/todos/${i}`,"PUT",o,q)).status&&(g("內容修改完成"),y())}catch(i){b(i)}finally{l.value=!0}}async function K(){if(l)try{k("登出中"),l.value=!1,(await it("https://todolist-api.hexschool.io/users/sign_out","POST",o)).status&&(document.cookie=`TokenCode=${o}; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`,g("登出成功"),d.push("/"))}catch(e){b(e)}finally{l.value=!0}}const D=I(U,1e3),W=I(V,1e3),G=I(z,1e3),R=I(J,1e3);return(e,t)=>(u(),f("div",gt,[a("header",null,[Y(nt),a("p",bt,j(p.value)+" 的代辦",1),a("a",{class:"login-out",onClick:K},"登出")]),a("div",wt,[A(a("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=i=>r.value=i),onKeyup:t[1]||(t[1]=F((...i)=>h(D)&&h(D)(...i),["enter"]))},null,544),[[M,r.value]]),a("button",{class:"addinput",onClick:t[2]||(t[2]=(...i)=>h(D)&&h(D)(...i))},Dt)]),C.value?(u(),f("div",It,Tt)):(u(),f("div",Et,[a("div",jt,[a("button",{class:E([{buttonActive:c.value==="all"}]),onClick:t[3]||(t[3]=i=>m("all"))},"全部",2),a("button",{class:E([{buttonActive:c.value==="pending"}]),onClick:t[4]||(t[4]=i=>m("pending"))},"待完成",2),a("button",{class:E([{buttonActive:c.value==="finish"}]),onClick:t[5]||(t[5]=i=>m("finish"))},"已完成",2)]),a("ul",St,[(u(!0),f(tt,null,et(w.value,i=>(u(),st(kt,{key:i.id,sendData:i,onChangeComplete:h(W),onDeleteItem:h(G),onEditItem:$,onEditOffItem:L,onEditHandle:h(R)},null,8,["sendData","onChangeComplete","onDeleteItem","onEditHandle"]))),128))]),a("div",Ot,[a("p",null,j(O.value)+"個待完成項目",1)])]))]))}},Bt=H(At,[["__scopeId","data-v-a2500cfa"]]);export{Bt as default};
